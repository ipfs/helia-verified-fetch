<!DOCTYPE html><html class="default" lang="en" data-base="./"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@helia/verified-fetch</title><meta name="description" content="Documentation for @helia/verified-fetch"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script><script async src="assets/hierarchy.js" id="tsd-hierarchy-script"></script>
<style>
:root.mermaid-enabled .mermaid-block > pre {
  display: none;
}
:root:not(.mermaid-enabled) .mermaid-block > .mermaid {
  display: none !important;
}

.mermaid-block > .mermaid[data-inserted].dark {
  display: var(--mermaid-dark-display);
}
.mermaid-block > .mermaid[data-inserted].light {
  display: var(--mermaid-light-display);
}

:root {
  --mermaid-dark-display: none;
  --mermaid-light-display: block;
}
@media (prefers-color-scheme: light) {
  :root {
    --mermaid-dark-display: none;
    --mermaid-light-display: block;
  }
}
@media (prefers-color-scheme: dark) {
  :root {
    --mermaid-dark-display: block;
    --mermaid-light-display: none;
  }
}
body.light, :root[data-theme="light"] {
  --mermaid-dark-display: none;
  --mermaid-light-display: block;
}
body.dark, :root[data-theme="dark"] {
  --mermaid-dark-display: block;
  --mermaid-light-display: none;
}
</style>
</head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="index.html" class="title">@helia/verified-fetch</a><div id="tsd-toolbar-links"></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h1>@helia/verified-fetch</h1></div><div class="tsd-panel tsd-typography"><p align="center">
  <a href="https://github.com/ipfs/helia" title="Helia">
    <img src="https://raw.githubusercontent.com/ipfs/helia/main/assets/helia.png" alt="Helia logo" width="300" />
  </a>
</p>
<h1 id="heliaverified-fetch" class="tsd-anchor-link">@helia/verified-fetch<a href="#heliaverified-fetch" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p><a href="https://ipfs.tech"><img src="https://img.shields.io/badge/project-IPFS-blue.svg?style=flat-square" alt="ipfs.tech"></a>
<a href="https://discuss.ipfs.tech"><img src="https://img.shields.io/discourse/https/discuss.ipfs.tech/posts.svg?style=flat-square" alt="Discuss"></a>
<a href="https://codecov.io/gh/ipfs/helia-verified-fetch"><img src="https://img.shields.io/codecov/c/github/ipfs/helia-verified-fetch.svg?style=flat-square" alt="codecov"></a>
<a href="https://github.com/ipfs/helia-verified-fetch/actions/workflows/js-test-and-release.yml?query=branch%3Amain"><img src="https://img.shields.io/github/actions/workflow/status/ipfs/helia-verified-fetch/js-test-and-release.yml?branch=main&amp;style=flat-square" alt="CI"></a></p>
<blockquote>
<p>A fetch-like API for obtaining verified &amp; trustless IPFS content on the web</p>
</blockquote>
<h1 id="about" class="tsd-anchor-link">About<a href="#about" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><!--

!IMPORTANT!

Everything in this README between "# About" and "# Install" is automatically
generated and will be overwritten the next time the doc generator is run.

To make changes to this section, please update the @packageDocumentation section
of src/index.js or src/index.ts

To experiment with formatting, please run "npm run docs" from the root of this
repo and examine the changes made.

-->
<p><code>@helia/verified-fetch</code> provides a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API">fetch</a>-like API for retrieving content from the <a href="https://ipfs.tech/">IPFS</a> network.</p>
<p>All content is retrieved in a <a href="https://www.techopedia.com/definition/trustless">trustless manner</a>, and the integrity of all bytes are verified by comparing hashes of the data.</p>
<p>By default, providers for CIDs are found using <a href="https://docs.ipfs.tech/concepts/public-utilities/#delegated-routing">delegated routing endpoints</a>.</p>
<p>Data is retrieved using the following strategies:</p>
<ul>
<li>Directly from providers, using <a href="https://docs.ipfs.tech/concepts/bitswap/">Bitswap</a> over WebSockets and WebRTC if available.</li>
<li>Directly from providers exposing a <a href="https://specs.ipfs.tech/http-gateways/trustless-gateway/">trustless gateway</a> over HTTPS.</li>
<li>As a fallback, if no providers reachable from a browser are found, data is retrieved using recursive gateways, e.g. <code>trustless-gateway.link</code> which can be configured.</li>
</ul>
<p>This is a marked improvement over <code>fetch</code> which offers no such protections and is vulnerable to all sorts of attacks like <a href="https://owasp.org/www-community/attacks/Content_Spoofing">Content Spoofing</a>, <a href="https://en.wikipedia.org/wiki/DNS_hijacking">DNS Hijacking</a>, etc.</p>
<p>A <code>verifiedFetch</code> function is exported to get up and running quickly, and a <code>createVerifiedFetch</code> function is also available that allows customizing the underlying <a href="https://ipfs.github.io/helia/">Helia</a> node for complete control over how content is retrieved.</p>
<p>Browser-cache-friendly <a href="https://developer.mozilla.org/en-US/docs/Web/API/Response">Response</a> objects are returned which should be instantly familiar to web developers.</p>
<p>Learn more in the <a href="https://blog.ipfs.tech/verified-fetch/">announcement blog post</a> and check out the <a href="https://github.com/ipfs-examples/helia-examples/tree/main/examples/helia-browser-verified-fetch">ready-to-run example</a>.</p>
<p>You may use any supported resource argument to fetch content:</p>
<ul>
<li><a href="https://multiformats.github.io/js-multiformats/classes/cid.CID.html">CID</a> instance</li>
<li>IPFS URL</li>
<li>IPNS URL</li>
</ul>
<h2 id="example---getting-started" class="tsd-anchor-link">Example - Getting started<a href="#example---getting-started" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">verifiedFetch</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@helia/verified-fetch&#39;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">resp</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">verifiedFetch</span><span class="hl-1">(</span><span class="hl-3">&#39;ipfs://bafy...&#39;</span><span class="hl-1">)</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">json</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">resp</span><span class="hl-1">.</span><span class="hl-6">json</span><span class="hl-1">()</span>
</code><button type="button">Copy</button></pre>

<h2 id="example---using-a-cid-instance-to-fetch-json" class="tsd-anchor-link">Example - Using a CID instance to fetch JSON<a href="#example---using-a-cid-instance-to-fetch-json" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">verifiedFetch</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@helia/verified-fetch&#39;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">CID</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;multiformats/cid&#39;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">cid</span><span class="hl-1"> = </span><span class="hl-5">CID</span><span class="hl-1">.</span><span class="hl-6">parse</span><span class="hl-1">(</span><span class="hl-3">&#39;bafyFoo&#39;</span><span class="hl-1">) </span><span class="hl-7">// some json file</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">response</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">verifiedFetch</span><span class="hl-1">(</span><span class="hl-2">cid</span><span class="hl-1">)</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">json</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">response</span><span class="hl-1">.</span><span class="hl-6">json</span><span class="hl-1">()</span>
</code><button type="button">Copy</button></pre>

<h2 id="example---using-ipfs-protocol-to-fetch-an-image" class="tsd-anchor-link">Example - Using IPFS protocol to fetch an image<a href="#example---using-ipfs-protocol-to-fetch-an-image" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">verifiedFetch</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@helia/verified-fetch&#39;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">response</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">verifiedFetch</span><span class="hl-1">(</span><span class="hl-3">&#39;ipfs://bafyFoo&#39;</span><span class="hl-1">) </span><span class="hl-7">// CID for some image file</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">blob</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">response</span><span class="hl-1">.</span><span class="hl-6">blob</span><span class="hl-1">()</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">image</span><span class="hl-1"> = </span><span class="hl-2">document</span><span class="hl-1">.</span><span class="hl-6">createElement</span><span class="hl-1">(</span><span class="hl-3">&#39;img&#39;</span><span class="hl-1">)</span><br/><span class="hl-2">image</span><span class="hl-1">.</span><span class="hl-2">src</span><span class="hl-1"> = </span><span class="hl-5">URL</span><span class="hl-1">.</span><span class="hl-6">createObjectURL</span><span class="hl-1">(</span><span class="hl-2">blob</span><span class="hl-1">)</span><br/><span class="hl-2">document</span><span class="hl-1">.</span><span class="hl-2">body</span><span class="hl-1">.</span><span class="hl-6">appendChild</span><span class="hl-1">(</span><span class="hl-2">image</span><span class="hl-1">)</span>
</code><button type="button">Copy</button></pre>

<h2 id="example---using-ipns-protocol-to-stream-a-big-file" class="tsd-anchor-link">Example - Using IPNS protocol to stream a big file<a href="#example---using-ipns-protocol-to-stream-a-big-file" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">verifiedFetch</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@helia/verified-fetch&#39;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">response</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">verifiedFetch</span><span class="hl-1">(</span><span class="hl-3">&#39;ipns://mydomain.com/path/to/very-long-file.log&#39;</span><span class="hl-1">)</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">bigFileStreamReader</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">response</span><span class="hl-1">.</span><span class="hl-2">body</span><span class="hl-1">?.</span><span class="hl-6">getReader</span><span class="hl-1">()</span>
</code><button type="button">Copy</button></pre>

<h2 id="configuration" class="tsd-anchor-link">Configuration<a href="#configuration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><h3 id="custom-http-gateways-and-routers" class="tsd-anchor-link">Custom HTTP gateways and routers<a href="#custom-http-gateways-and-routers" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Out of the box <code>@helia/verified-fetch</code> uses a default set of <a href="https://specs.ipfs.tech/http-gateways/trustless-gateway/">trustless gateways</a> for fetching blocks and <a href="https://specs.ipfs.tech/routing/http-routing-v1/">HTTP delegated routers</a> for performing routing tasks - looking up peers, resolving/publishing <a href="https://docs.ipfs.tech/concepts/ipns/">IPNS</a> names, etc.</p>
<p>It's possible to override these by passing <code>gateways</code> and <code>routers</code> keys to the <code>createVerifiedFetch</code> function:</p>
<h2 id="example---configuring-gateways-and-routers" class="tsd-anchor-link">Example - Configuring gateways and routers<a href="#example---configuring-gateways-and-routers" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">createVerifiedFetch</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@helia/verified-fetch&#39;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">fetch</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">createVerifiedFetch</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-2">gateways:</span><span class="hl-1"> [</span><span class="hl-3">&#39;https://trustless-gateway.link&#39;</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-2">routers:</span><span class="hl-1"> [</span><span class="hl-3">&#39;http://delegated-ipfs.dev&#39;</span><span class="hl-1">]</span><br/><span class="hl-1">})</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">resp</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">fetch</span><span class="hl-1">(</span><span class="hl-3">&#39;ipfs://bafy...&#39;</span><span class="hl-1">)</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">json</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">resp</span><span class="hl-1">.</span><span class="hl-6">json</span><span class="hl-1">()</span>
</code><button type="button">Copy</button></pre>

<h3 id="usage-with-customized-helia" class="tsd-anchor-link">Usage with customized Helia<a href="#usage-with-customized-helia" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>For full control of how <code>@helia/verified-fetch</code> fetches content from the distributed web you can pass a preconfigured Helia node to <code>createVerifiedFetch</code>.</p>
<p>The <a href="https://www.npmjs.com/package/helia">helia</a> module is configured with a libp2p node that is suited for decentralized applications, alternatively <a href="https://www.npmjs.com/package/@helia/http">@helia/http</a> is available which uses HTTP gateways for all network operations.</p>
<p>You can see variations of Helia and js-libp2p configuration options at <a href="https://ipfs.github.io/helia/interfaces/helia.HeliaInit.html">https://ipfs.github.io/helia/interfaces/helia.HeliaInit.html</a>.</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">trustlessGateway</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@helia/block-brokers&#39;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">createHeliaHTTP</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@helia/http&#39;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">delegatedHTTPRouting</span><span class="hl-1">, </span><span class="hl-2">httpGatewayRouting</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@helia/routers&#39;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">createVerifiedFetch</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@helia/verified-fetch&#39;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">fetch</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">createVerifiedFetch</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">createHeliaHTTP</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">blockBrokers:</span><span class="hl-1"> [</span><br/><span class="hl-1">      </span><span class="hl-6">trustlessGateway</span><span class="hl-1">()</span><br/><span class="hl-1">    ],</span><br/><span class="hl-1">    </span><span class="hl-2">routers:</span><span class="hl-1"> [</span><br/><span class="hl-1">      </span><span class="hl-6">delegatedHTTPRouting</span><span class="hl-1">(</span><span class="hl-3">&#39;http://delegated-ipfs.dev&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">      </span><span class="hl-6">httpGatewayRouting</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-2">gateways:</span><span class="hl-1"> [</span><span class="hl-3">&#39;https://mygateway.example.net&#39;</span><span class="hl-1">, </span><span class="hl-3">&#39;https://trustless-gateway.link&#39;</span><span class="hl-1">]</span><br/><span class="hl-1">      })</span><br/><span class="hl-1">    ]</span><br/><span class="hl-1">  })</span><br/><span class="hl-1">)</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">resp</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">fetch</span><span class="hl-1">(</span><span class="hl-3">&#39;ipfs://bafy...&#39;</span><span class="hl-1">)</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">json</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">resp</span><span class="hl-1">.</span><span class="hl-6">json</span><span class="hl-1">()</span>
</code><button type="button">Copy</button></pre>

<h3 id="custom-content-type-parsing" class="tsd-anchor-link">Custom content-type parsing<a href="#custom-content-type-parsing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>By default, if the response can be parsed as JSON, <code>@helia/verified-fetch</code> sets the <code>Content-Type</code> header as <code>application/json</code>, otherwise it sets it as <code>application/octet-stream</code> - this is because the <code>.json()</code>, <code>.text()</code>, <code>.blob()</code>, and <code>.arrayBuffer()</code> methods will usually work as expected without a detailed content type.</p>
<p>If you require an accurate content-type you can provide a <code>contentTypeParser</code> function as an option to <code>createVerifiedFetch</code> to handle parsing the content type.</p>
<p>The function you provide will be called with the first chunk of bytes from the file and should return a string or a promise of a string.</p>
<h2 id="example---customizing-content-type-parsing" class="tsd-anchor-link">Example - Customizing content-type parsing<a href="#example---customizing-content-type-parsing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">createVerifiedFetch</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@helia/verified-fetch&#39;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">fileTypeFromBuffer</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;file-type&#39;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">fetch</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">createVerifiedFetch</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-2">gateways:</span><span class="hl-1"> [</span><span class="hl-3">&#39;https://trustless-gateway.link&#39;</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-2">routers:</span><span class="hl-1"> [</span><span class="hl-3">&#39;http://delegated-ipfs.dev&#39;</span><span class="hl-1">]</span><br/><span class="hl-1">}, {</span><br/><span class="hl-1">  </span><span class="hl-6">contentTypeParser</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> (</span><span class="hl-2">bytes</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">// call to some magic-byte recognition library like magic-bytes, file-type, or your own custom byte recognition</span><br/><span class="hl-1">    </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">result</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">fileTypeFromBuffer</span><span class="hl-1">(</span><span class="hl-2">bytes</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-2">result</span><span class="hl-1">?.</span><span class="hl-2">mime</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">})</span>
</code><button type="button">Copy</button></pre>

<h3 id="custom-dns-resolvers" class="tsd-anchor-link">Custom DNS resolvers<a href="#custom-dns-resolvers" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>If you don't want to leak DNS queries to the default resolvers, you can provide your own list of DNS resolvers to <code>createVerifiedFetch</code>.</p>
<p>Note that you do not need to provide both a DNS-over-HTTPS and a DNS-over-JSON resolver, and you should prefer <code>dnsJsonOverHttps</code> resolvers for usage in the browser for a smaller bundle size. See <a href="https://github.com/ipfs/helia/tree/main/packages/ipns#example---using-dns-json-over-https">https://github.com/ipfs/helia/tree/main/packages/ipns#example---using-dns-json-over-https</a> for more information.</p>
<h2 id="example---customizing-dns-resolvers" class="tsd-anchor-link">Example - Customizing DNS resolvers<a href="#example---customizing-dns-resolvers" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">createVerifiedFetch</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@helia/verified-fetch&#39;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">dnsJsonOverHttps</span><span class="hl-1">, </span><span class="hl-2">dnsOverHttps</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@multiformats/dns/resolvers&#39;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">fetch</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">createVerifiedFetch</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-2">gateways:</span><span class="hl-1"> [</span><span class="hl-3">&#39;https://trustless-gateway.link&#39;</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-2">routers:</span><span class="hl-1"> [</span><span class="hl-3">&#39;http://delegated-ipfs.dev&#39;</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-2">dnsResolvers:</span><span class="hl-1"> [</span><br/><span class="hl-1">    </span><span class="hl-6">dnsJsonOverHttps</span><span class="hl-1">(</span><span class="hl-3">&#39;https://my-dns-resolver.example.com/dns-json&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">    </span><span class="hl-6">dnsOverHttps</span><span class="hl-1">(</span><span class="hl-3">&#39;https://my-dns-resolver.example.com/dns-query&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  ]</span><br/><span class="hl-1">})</span>
</code><button type="button">Copy</button></pre>

<h2 id="example---customizing-dns-per-tld-resolvers" class="tsd-anchor-link">Example - Customizing DNS per-TLD resolvers<a href="#example---customizing-dns-per-tld-resolvers" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>DNS resolvers can be configured to only service DNS queries for specific
TLDs:</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">createVerifiedFetch</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@helia/verified-fetch&#39;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">dnsJsonOverHttps</span><span class="hl-1">, </span><span class="hl-2">dnsOverHttps</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@multiformats/dns/resolvers&#39;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">fetch</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">createVerifiedFetch</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-2">gateways:</span><span class="hl-1"> [</span><span class="hl-3">&#39;https://trustless-gateway.link&#39;</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-2">routers:</span><span class="hl-1"> [</span><span class="hl-3">&#39;http://delegated-ipfs.dev&#39;</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-2">dnsResolvers:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">// this resolver will only be used for `.com` domains (note - this could</span><br/><span class="hl-1">    </span><span class="hl-7">// also be an array of resolvers)</span><br/><span class="hl-1">    </span><span class="hl-3">&#39;com.&#39;</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-6">dnsJsonOverHttps</span><span class="hl-1">(</span><span class="hl-3">&#39;https://my-dns-resolver.example.com/dns-json&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">    </span><span class="hl-7">// this resolver will be used for everything else (note - this could</span><br/><span class="hl-1">    </span><span class="hl-7">// also be an array of resolvers)</span><br/><span class="hl-1">    </span><span class="hl-3">&#39;.&#39;</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-6">dnsOverHttps</span><span class="hl-1">(</span><span class="hl-3">&#39;https://my-dns-resolver.example.com/dns-query&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">})</span>
</code><button type="button">Copy</button></pre>

<h3 id="custom-hashers" class="tsd-anchor-link">Custom Hashers<a href="#custom-hashers" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>By default, <code>@helia/verified-fetch</code> supports <code>sha256</code>, <code>sha512</code>, and <code>identity</code> hashers.</p>
<p>If you need to use a different hasher, you can provide a <a href="https://multiformats.github.io/js-multiformats/interfaces/hashes_interface.MultihashHasher.html">custom <code>hasher</code> function</a> as an option to <code>createVerifiedFetch</code>.</p>
<h2 id="example---passing-a-custom-hashing-function" class="tsd-anchor-link">Example - Passing a custom hashing function<a href="#example---passing-a-custom-hashing-function" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">createVerifiedFetch</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@helia/verified-fetch&#39;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">blake2b256</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@multiformats/blake2/blake2b&#39;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">verifiedFetch</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">createVerifiedFetch</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-2">gateways:</span><span class="hl-1"> [</span><span class="hl-3">&#39;https://ipfs.io&#39;</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-2">hashers:</span><span class="hl-1"> [</span><span class="hl-2">blake2b256</span><span class="hl-1">]</span><br/><span class="hl-1">})</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">resp</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">verifiedFetch</span><span class="hl-1">(</span><span class="hl-3">&#39;ipfs://cid-using-blake2b256&#39;</span><span class="hl-1">)</span>
</code><button type="button">Copy</button></pre>

<h3 id="ipld-codec-handling" class="tsd-anchor-link">IPLD codec handling<a href="#ipld-codec-handling" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>IPFS supports several data formats (typically referred to as codecs) which are included in the CID. <code>@helia/verified-fetch</code> attempts to abstract away some of the details for easier consumption.</p>
<h4 id="dag-pb" class="tsd-anchor-link">DAG-PB<a href="#dag-pb" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p><a href="https://ipld.io/docs/codecs/known/dag-pb/">DAG-PB</a> is the codec we are most likely to encounter, it is what <a href="https://github.com/ipfs/specs/blob/main/UNIXFS.md">UnixFS</a> uses under the hood.</p>
<h5 id="using-the-dag-pb-codec-as-a-blob" class="tsd-anchor-link">Using the DAG-PB codec as a Blob<a href="#using-the-dag-pb-codec-as-a-blob" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">verifiedFetch</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@helia/verified-fetch&#39;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">res</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">verifiedFetch</span><span class="hl-1">(</span><span class="hl-3">&#39;ipfs://Qmfoo&#39;</span><span class="hl-1">)</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">blob</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">res</span><span class="hl-1">.</span><span class="hl-6">blob</span><span class="hl-1">()</span><br/><br/><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">info</span><span class="hl-1">(</span><span class="hl-2">blob</span><span class="hl-1">) </span><span class="hl-7">// Blob { size: x, type: &#39;application/octet-stream&#39; }</span>
</code><button type="button">Copy</button></pre>

<h5 id="using-the-dag-pb-codec-as-an-arraybuffer" class="tsd-anchor-link">Using the DAG-PB codec as an ArrayBuffer<a href="#using-the-dag-pb-codec-as-an-arraybuffer" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">verifiedFetch</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@helia/verified-fetch&#39;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">res</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">verifiedFetch</span><span class="hl-1">(</span><span class="hl-3">&#39;ipfs://Qmfoo&#39;</span><span class="hl-1">)</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">buf</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">res</span><span class="hl-1">.</span><span class="hl-6">arrayBuffer</span><span class="hl-1">()</span><br/><br/><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">info</span><span class="hl-1">(</span><span class="hl-2">buf</span><span class="hl-1">) </span><span class="hl-7">// ArrayBuffer { [Uint8Contents]: &lt; ... &gt;, byteLength: x }</span>
</code><button type="button">Copy</button></pre>

<h5 id="using-the-dag-pb-codec-as-a-stream" class="tsd-anchor-link">Using the DAG-PB codec as a stream<a href="#using-the-dag-pb-codec-as-a-stream" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">verifiedFetch</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@helia/verified-fetch&#39;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">res</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">verifiedFetch</span><span class="hl-1">(</span><span class="hl-3">&#39;ipfs://Qmfoo&#39;</span><span class="hl-1">)</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">reader</span><span class="hl-1"> = </span><span class="hl-2">res</span><span class="hl-1">.</span><span class="hl-2">body</span><span class="hl-1">?.</span><span class="hl-6">getReader</span><span class="hl-1">()</span><br/><br/><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">reader</span><span class="hl-1"> == </span><span class="hl-4">null</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">Error</span><span class="hl-1">(</span><span class="hl-3">&#39;Could not create reader from response body&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-0">while</span><span class="hl-1"> (</span><span class="hl-4">true</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">next</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">reader</span><span class="hl-1">.</span><span class="hl-6">read</span><span class="hl-1">()</span><br/><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">next</span><span class="hl-1">?.</span><span class="hl-2">done</span><span class="hl-1"> === </span><span class="hl-4">true</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">break</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">next</span><span class="hl-1">?.</span><span class="hl-2">value</span><span class="hl-1"> != </span><span class="hl-4">null</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">info</span><span class="hl-1">(</span><span class="hl-2">next</span><span class="hl-1">.</span><span class="hl-2">value</span><span class="hl-1">) </span><span class="hl-7">// Uint8Array(x) [ ... ]</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<h5 id="content-type" class="tsd-anchor-link">Content-Type<a href="#content-type" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><p>When fetching <code>DAG-PB</code> data, the content type will be set to <code>application/octet-stream</code> unless a custom content-type parser is configured.</p>
<h4 id="json" class="tsd-anchor-link">JSON<a href="#json" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>The JSON codec is a very simple codec, a block parseable with this codec is a JSON string encoded into a <code>Uint8Array</code>.</p>
<h5 id="using-the-json-codec" class="tsd-anchor-link">Using the JSON codec<a href="#using-the-json-codec" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-4">*</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-2">json</span><span class="hl-1"> </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;multiformats/codecs/json&#39;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">block</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">TextEncoder</span><span class="hl-1">().</span><span class="hl-6">encode</span><span class="hl-1">(</span><span class="hl-3">&#39;{ &quot;hello&quot;: &quot;world&quot; }&#39;</span><span class="hl-1">)</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">obj</span><span class="hl-1"> = </span><span class="hl-2">json</span><span class="hl-1">.</span><span class="hl-6">decode</span><span class="hl-1">(</span><span class="hl-2">block</span><span class="hl-1">)</span><br/><br/><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">info</span><span class="hl-1">(</span><span class="hl-2">obj</span><span class="hl-1">) </span><span class="hl-7">// { hello: &#39;world&#39; }</span>
</code><button type="button">Copy</button></pre>

<h5 id="content-type-1" class="tsd-anchor-link">Content-Type<a href="#content-type-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><p>When the <code>JSON</code> codec is encountered, the <code>Content-Type</code> header of the response will be set to <code>application/json</code>.</p>
<h3 id="dag-json" class="tsd-anchor-link">DAG-JSON<a href="#dag-json" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p><a href="https://ipld.io/docs/codecs/known/dag-json/">DAG-JSON</a> expands on the <code>JSON</code> codec, adding the ability to contain <a href="https://docs.ipfs.tech/concepts/content-addressing/">CID</a>s which act as links to other blocks, and byte arrays.</p>
<p><code>CID</code>s and byte arrays are represented using special object structures with a single <code>&quot;/&quot;</code> property.</p>
<p>Using <code>DAG-JSON</code> has two important caveats:</p>
<ol>
<li>Your <code>JSON</code> structure cannot contain an object with only a <code>&quot;/&quot;</code> property, as it will be interpreted as a special type.</li>
<li>Since <code>JSON</code> has no technical limit on number sizes, <code>DAG-JSON</code> also allows numbers larger than <code>Number.MAX_SAFE_INTEGER</code>. JavaScript requires use of <code>BigInt</code>s to represent numbers larger than this, and <code>JSON.parse</code> does not support them, so precision will be lost.</li>
</ol>
<p>Otherwise this codec follows the same rules as the <code>JSON</code> codec.</p>
<h5 id="using-the-dag-json-codec" class="tsd-anchor-link">Using the DAG-JSON codec<a href="#using-the-dag-json-codec" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-4">*</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-2">dagJson</span><span class="hl-1"> </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@ipld/dag-json&#39;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">block</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">TextEncoder</span><span class="hl-1">().</span><span class="hl-6">encode</span><span class="hl-1">(</span><span class="hl-3">`{</span><br/><span class="hl-3">  &quot;hello&quot;: &quot;world&quot;,</span><br/><span class="hl-3">  &quot;cid&quot;: {</span><br/><span class="hl-3">    &quot;/&quot;: &quot;baeaaac3imvwgy3zao5xxe3de&quot;</span><br/><span class="hl-3">  },</span><br/><span class="hl-3">  &quot;buf&quot;: {</span><br/><span class="hl-3">    &quot;/&quot;: {</span><br/><span class="hl-3">      &quot;bytes&quot;: &quot;AAECAwQ&quot;</span><br/><span class="hl-3">    }</span><br/><span class="hl-3">  }</span><br/><span class="hl-3">}`</span><span class="hl-1">)</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">obj</span><span class="hl-1"> = </span><span class="hl-2">dagJson</span><span class="hl-1">.</span><span class="hl-6">decode</span><span class="hl-1">(</span><span class="hl-2">block</span><span class="hl-1">)</span><br/><br/><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">info</span><span class="hl-1">(</span><span class="hl-2">obj</span><span class="hl-1">)</span><br/><span class="hl-7">// {</span><br/><span class="hl-7">// hello: &#39;world&#39;,</span><br/><span class="hl-7">// cid: CID(baeaaac3imvwgy3zao5xxe3de),</span><br/><span class="hl-7">// buf: Uint8Array(5) [ 0, 1, 2, 3, 4 ]</span><br/><span class="hl-7">// }</span>
</code><button type="button">Copy</button></pre>

<h5 id="content-type-2" class="tsd-anchor-link">Content-Type<a href="#content-type-2" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><p>When the <code>DAG-JSON</code> codec is encountered in the requested CID, the <code>Content-Type</code> header of the response will be set to <code>application/json</code>.</p>
<p><code>DAG-JSON</code> data can be parsed from the response by using the <code>.json()</code> function, which will return <code>CID</code>s/byte arrays as plain <code>{ &quot;/&quot;: ... }</code> objects:</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">verifiedFetch</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@helia/verified-fetch&#39;</span><br/><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-4">*</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-2">dagJson</span><span class="hl-1"> </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@ipld/dag-json&#39;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">res</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">verifiedFetch</span><span class="hl-1">(</span><span class="hl-3">&#39;ipfs://bafyDAGJSON&#39;</span><span class="hl-1">)</span><br/><br/><span class="hl-7">// either:</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">obj</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">res</span><span class="hl-1">.</span><span class="hl-6">json</span><span class="hl-1">()</span><br/><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">info</span><span class="hl-1">(</span><span class="hl-2">obj</span><span class="hl-1">.</span><span class="hl-2">cid</span><span class="hl-1">) </span><span class="hl-7">// { &quot;/&quot;: &quot;baeaaac3imvwgy3zao5xxe3de&quot; }</span><br/><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">info</span><span class="hl-1">(</span><span class="hl-2">obj</span><span class="hl-1">.</span><span class="hl-2">buf</span><span class="hl-1">) </span><span class="hl-7">// { &quot;/&quot;: { &quot;bytes&quot;: &quot;AAECAwQ&quot; } }</span>
</code><button type="button">Copy</button></pre>

<p>Alternatively, it can be decoded using the <code>@ipld/dag-json</code> module and the <code>.arrayBuffer()</code> method, in which case you will get <code>CID</code> objects and <code>Uint8Array</code>s:</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">verifiedFetch</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@helia/verified-fetch&#39;</span><br/><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-4">*</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-2">dagJson</span><span class="hl-1"> </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@ipld/dag-json&#39;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">res</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">verifiedFetch</span><span class="hl-1">(</span><span class="hl-3">&#39;ipfs://bafyDAGJSON&#39;</span><span class="hl-1">)</span><br/><br/><span class="hl-7">// or:</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">obj</span><span class="hl-1"> = </span><span class="hl-2">dagJson</span><span class="hl-1">.</span><span class="hl-6">decode</span><span class="hl-1">&lt;</span><span class="hl-8">any</span><span class="hl-1">&gt;(</span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">res</span><span class="hl-1">.</span><span class="hl-6">arrayBuffer</span><span class="hl-1">())</span><br/><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">info</span><span class="hl-1">(</span><span class="hl-2">obj</span><span class="hl-1">.</span><span class="hl-2">cid</span><span class="hl-1">) </span><span class="hl-7">// CID(baeaaac3imvwgy3zao5xxe3de)</span><br/><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">info</span><span class="hl-1">(</span><span class="hl-2">obj</span><span class="hl-1">.</span><span class="hl-2">buf</span><span class="hl-1">) </span><span class="hl-7">// Uint8Array(5) [ 0, 1, 2, 3, 4 ]</span>
</code><button type="button">Copy</button></pre>

<h4 id="dag-cbor" class="tsd-anchor-link">DAG-CBOR<a href="#dag-cbor" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p><a href="https://ipld.io/docs/codecs/known/dag-cbor/">DAG-CBOR</a> uses the <a href="https://cbor.io/">Concise Binary Object Representation</a> format for serialization instead of JSON.</p>
<p>This supports more data types in a safer way than JSON and is smaller on the wire to boot so is usually preferable to JSON or DAG-JSON.</p>
<h5 id="content-type-3" class="tsd-anchor-link">Content-Type<a href="#content-type-3" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><p>Not all data types supported by <code>DAG-CBOR</code> can be successfully turned into JSON and back into the same binary form.</p>
<p>When a decoded block can be round-tripped to JSON, the <code>Content-Type</code> will be set to <code>application/json</code>. In this case the <code>.json()</code> method on the <code>Response</code> object can be used to obtain an object representation of the response.</p>
<p>When it cannot, the <code>Content-Type</code> will be <code>application/octet-stream</code> - in this case the <code>@ipld/dag-json</code> module must be used to deserialize the return value from <code>.arrayBuffer()</code>.</p>
<h5 id="detecting-json-safe-dag-cbor" class="tsd-anchor-link">Detecting JSON-safe DAG-CBOR<a href="#detecting-json-safe-dag-cbor" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h5><p>If the <code>Content-Type</code> header of the response is <code>application/json</code>, the <code>.json()</code> method may be used to access the response body in object form, otherwise the <code>.arrayBuffer()</code> method must be used to decode the raw bytes using the <code>@ipld/dag-cbor</code> module.</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">verifiedFetch</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@helia/verified-fetch&#39;</span><br/><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-4">*</span><span class="hl-1"> </span><span class="hl-0">as</span><span class="hl-1"> </span><span class="hl-2">dagCbor</span><span class="hl-1"> </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@ipld/dag-cbor&#39;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">res</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">verifiedFetch</span><span class="hl-1">(</span><span class="hl-3">&#39;ipfs://bafyDagCborCID&#39;</span><span class="hl-1">)</span><br/><span class="hl-4">let</span><span class="hl-1"> </span><span class="hl-2">obj</span><br/><br/><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">res</span><span class="hl-1">.</span><span class="hl-2">headers</span><span class="hl-1">.</span><span class="hl-6">get</span><span class="hl-1">(</span><span class="hl-3">&#39;Content-Type&#39;</span><span class="hl-1">) === </span><span class="hl-3">&#39;application/json&#39;</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-7">// DAG-CBOR data can be safely decoded as JSON</span><br/><span class="hl-1">  </span><span class="hl-2">obj</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">res</span><span class="hl-1">.</span><span class="hl-6">json</span><span class="hl-1">()</span><br/><span class="hl-1">} </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-7">// response contains non-JSON friendly data types</span><br/><span class="hl-1">  </span><span class="hl-2">obj</span><span class="hl-1"> = </span><span class="hl-2">dagCbor</span><span class="hl-1">.</span><span class="hl-6">decode</span><span class="hl-1">(</span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">res</span><span class="hl-1">.</span><span class="hl-6">arrayBuffer</span><span class="hl-1">())</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">info</span><span class="hl-1">(</span><span class="hl-2">obj</span><span class="hl-1">) </span><span class="hl-7">// ...</span>
</code><button type="button">Copy</button></pre>

<h2 id="the-accept-header" class="tsd-anchor-link">The <code>Accept</code> header<a href="#the-accept-header" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The <code>Accept</code> header can be passed to override certain response processing, or to ensure that the final <code>Content-Type</code> of the response is the one that is expected.</p>
<p>If the final <code>Content-Type</code> does not match the <code>Accept</code> header, or if the content cannot be represented in the format dictated by the <code>Accept</code> header, or you have configured a custom content type parser, and that parser returns a value that isn't in the accept header, a <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/406">406: Not Acceptable</a> response will be returned:</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">verifiedFetch</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@helia/verified-fetch&#39;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">res</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">verifiedFetch</span><span class="hl-1">(</span><span class="hl-3">&#39;ipfs://bafyJPEGImageCID&#39;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-2">headers:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">accept:</span><span class="hl-1"> </span><span class="hl-3">&#39;image/png&#39;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">})</span><br/><br/><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">info</span><span class="hl-1">(</span><span class="hl-2">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">) </span><span class="hl-7">// 406 - the image was a JPEG but we specified PNG as the accept header</span>
</code><button type="button">Copy</button></pre>

<p>It can also be used to skip processing the data from some formats such as <code>DAG-CBOR</code> if you wish to handle decoding it yourself:</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">verifiedFetch</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@helia/verified-fetch&#39;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">res</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">verifiedFetch</span><span class="hl-1">(</span><span class="hl-3">&#39;ipfs://bafyDAGCBORCID&#39;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-2">headers:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">accept:</span><span class="hl-1"> </span><span class="hl-3">&#39;application/octet-stream&#39;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">})</span><br/><br/><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">info</span><span class="hl-1">(</span><span class="hl-2">res</span><span class="hl-1">.</span><span class="hl-2">headers</span><span class="hl-1">.</span><span class="hl-6">get</span><span class="hl-1">(</span><span class="hl-3">&#39;accept&#39;</span><span class="hl-1">)) </span><span class="hl-7">// application/octet-stream</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">buf</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">res</span><span class="hl-1">.</span><span class="hl-6">arrayBuffer</span><span class="hl-1">() </span><span class="hl-7">// raw bytes, not processed as JSON</span>
</code><button type="button">Copy</button></pre>

<h2 id="redirects" class="tsd-anchor-link">Redirects<a href="#redirects" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>If a requested URL contains a path component, that path component resolves to
a UnixFS directory, but the URL does not have a trailing slash, one will be
added to form a canonical URL for that resource, otherwise the request will
be resolved as normal.</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">verifiedFetch</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@helia/verified-fetch&#39;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">res</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">verifiedFetch</span><span class="hl-1">(</span><span class="hl-3">&#39;ipfs://bafyfoo/path/to/dir&#39;</span><span class="hl-1">)</span><br/><br/><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">info</span><span class="hl-1">(</span><span class="hl-2">res</span><span class="hl-1">.</span><span class="hl-2">url</span><span class="hl-1">) </span><span class="hl-7">// ipfs://bafyfoo/path/to/dir/</span>
</code><button type="button">Copy</button></pre>

<p>It's possible to prevent this behavior and/or handle a redirect manually
through use of the <a href="https://developer.mozilla.org/en-US/docs/Web/API/fetch#redirect">redirect</a>
option.</p>
<h2 id="example---redirect-follow" class="tsd-anchor-link">Example - Redirect: follow<a href="#example---redirect-follow" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This is the default value and is what happens if no value is specified.</p>
<pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">verifiedFetch</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@helia/verified-fetch&#39;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">res</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">verifiedFetch</span><span class="hl-1">(</span><span class="hl-3">&#39;ipfs://bafyfoo/path/to/dir&#39;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-2">redirect:</span><span class="hl-1"> </span><span class="hl-3">&#39;follow&#39;</span><br/><span class="hl-1">})</span><br/><br/><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">info</span><span class="hl-1">(</span><span class="hl-2">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">) </span><span class="hl-7">// 200</span><br/><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">info</span><span class="hl-1">(</span><span class="hl-2">res</span><span class="hl-1">.</span><span class="hl-2">url</span><span class="hl-1">) </span><span class="hl-7">// ipfs://bafyfoo/path/to/dir/</span><br/><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">info</span><span class="hl-1">(</span><span class="hl-2">res</span><span class="hl-1">.</span><span class="hl-2">redirected</span><span class="hl-1">) </span><span class="hl-7">// true</span>
</code><button type="button">Copy</button></pre>

<h2 id="example---redirect-error" class="tsd-anchor-link">Example - Redirect: error<a href="#example---redirect-error" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This causes a <code>TypeError</code> to be thrown if a URL would cause a redirect.</p>
<pre><code class="typescript"><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">verifiedFetch</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@helia/verified-fetch&#39;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">res</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">verifiedFetch</span><span class="hl-1">(</span><span class="hl-3">&#39;ipfs://bafyfoo/path/to/dir&#39;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-2">redirect:</span><span class="hl-1"> </span><span class="hl-3">&#39;error&#39;</span><br/><span class="hl-1">})</span><br/><span class="hl-7">// throw TypeError(&#39;Failed to fetch&#39;)</span>
</code><button type="button">Copy</button></pre>

<h2 id="example---redirect-manual" class="tsd-anchor-link">Example - Redirect: manual<a href="#example---redirect-manual" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Manual redirects allow the user to process the redirect. A <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/301">301</a>
is returned, and the location to redirect to is available as the &quot;location&quot;
response header.</p>
<p>This differs slightly from HTTP fetch which returns an opaque response as the
browser itself is expected to process the redirect and hide all details from
the user.</p>
<pre><code class="typescript"><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">verifiedFetch</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@helia/verified-fetch&#39;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">res</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">verifiedFetch</span><span class="hl-1">(</span><span class="hl-3">&#39;ipfs://bafyfoo/path/to/dir&#39;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-2">redirect:</span><span class="hl-1"> </span><span class="hl-3">&#39;manual&#39;</span><br/><span class="hl-1">})</span><br/><br/><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">info</span><span class="hl-1">(</span><span class="hl-2">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">) </span><span class="hl-7">// 301</span><br/><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">info</span><span class="hl-1">(</span><span class="hl-2">res</span><span class="hl-1">.</span><span class="hl-2">url</span><span class="hl-1">) </span><span class="hl-7">// ipfs://bafyfoo/path/to/dir</span><br/><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">info</span><span class="hl-1">(</span><span class="hl-2">res</span><span class="hl-1">.</span><span class="hl-2">redirected</span><span class="hl-1">) </span><span class="hl-7">// false</span><br/><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">info</span><span class="hl-1">(</span><span class="hl-2">res</span><span class="hl-1">.</span><span class="hl-2">headers</span><span class="hl-1">.</span><span class="hl-6">get</span><span class="hl-1">(</span><span class="hl-3">&#39;location&#39;</span><span class="hl-1">)) </span><span class="hl-7">// ipfs://bafyfoo/path/to/dir/</span>
</code><button type="button">Copy</button></pre>

<h2 id="comparison-to-fetch" class="tsd-anchor-link">Comparison to fetch<a href="#comparison-to-fetch" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This module attempts to act as similarly to the <code>fetch()</code> API as possible.</p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/API/fetch">The <code>fetch()</code> API</a> takes two parameters:</p>
<ol>
<li>A <a href="https://developer.mozilla.org/en-US/docs/Web/API/fetch#resource">resource</a></li>
<li>An <a href="https://developer.mozilla.org/en-US/docs/Web/API/fetch#options">options object</a></li>
</ol>
<h3 id="resource-argument" class="tsd-anchor-link">Resource argument<a href="#resource-argument" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>This library supports the following methods of fetching web3 content from IPFS:</p>
<ol>
<li>IPFS protocol: <code>ipfs://&lt;cidv0&gt;</code> &amp; <code>ipfs://&lt;cidv1&gt;</code></li>
<li>IPNS protocol: <code>ipns://&lt;peerId&gt;</code> &amp; <code>ipns://&lt;publicKey&gt;</code> &amp; <code>ipns://&lt;hostUri_Supporting_DnsLink_TxtRecords&gt;</code></li>
<li>CID instances: An actual CID instance <code>CID.parse('bafy...')</code></li>
</ol>
<p>As well as support for pathing &amp; params for items 1 &amp; 2 above according to <a href="https://specs.ipfs.tech/http-gateways/path-gateway">IPFS - Path Gateway Specification</a> &amp; <a href="https://specs.ipfs.tech/http-gateways/trustless-gateway/">IPFS - Trustless Gateway Specification</a>. Further refinement of those specifications specifically for web-based scenarios can be found in the <a href="https://github.com/ipfs/specs/pull/453">Web Pathing Specification IPIP</a>.</p>
<p>If you pass a CID instance, it assumes you want the content for that specific CID only, and does not support pathing or params for that CID.</p>
<h3 id="options-argument" class="tsd-anchor-link">Options argument<a href="#options-argument" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>This library does not plan to support the exact Fetch API options object, as some of the arguments don't make sense. Instead, it will only support options necessary to meet <a href="https://specs.ipfs.tech/">IPFS specs</a> related to specifying the resultant shape of desired content.</p>
<p>Some of those header specifications are:</p>
<ol>
<li><a href="https://specs.ipfs.tech/http-gateways/path-gateway/#request-headers">https://specs.ipfs.tech/http-gateways/path-gateway/#request-headers</a></li>
<li><a href="https://specs.ipfs.tech/http-gateways/trustless-gateway/#request-headers">https://specs.ipfs.tech/http-gateways/trustless-gateway/#request-headers</a></li>
<li><a href="https://specs.ipfs.tech/http-gateways/subdomain-gateway/#request-headers">https://specs.ipfs.tech/http-gateways/subdomain-gateway/#request-headers</a></li>
</ol>
<p>Where possible, options and Helia internals will be automatically configured to the appropriate codec &amp; content type based on the <code>verified-fetch</code> configuration and <code>options</code> argument passed.</p>
<p>Known Fetch API options that will be supported:</p>
<ol>
<li><code>signal</code> - An AbortSignal that a user can use to abort the request.</li>
<li><code>redirect</code> - A string that specifies the redirect type. One of <code>follow</code>, <code>error</code>, or <code>manual</code>. Defaults to <code>follow</code>. Best effort to adhere to the <a href="https://developer.mozilla.org/en-US/docs/Web/API/fetch#redirect">Fetch API redirect</a> parameter.</li>
<li><code>headers</code> - An object of headers to be sent with the request. Best effort to adhere to the <a href="https://developer.mozilla.org/en-US/docs/Web/API/fetch#headers">Fetch API headers</a> parameter.
<ul>
<li><code>accept</code> - A string that specifies the accept header. Relevant values:
<ul>
<li><a href="https://www.iana.org/assignments/media-types/application/vnd.ipld.raw"><code>vnd.ipld.raw</code></a>. (default)</li>
<li><a href="https://www.iana.org/assignments/media-types/application/vnd.ipld.car"><code>vnd.ipld.car</code></a></li>
<li><a href="https://www.iana.org/assignments/media-types/application/vnd.ipfs.ipns-record"><code>vnd.ipfs.ipns-record</code></a></li>
</ul>
</li>
</ul>
</li>
<li><code>method</code> - A string that specifies the HTTP method to use for the request. Defaults to <code>GET</code>. Best effort to adhere to the <a href="https://developer.mozilla.org/en-US/docs/Web/API/fetch#method">Fetch API method</a> parameter.</li>
<li><code>body</code> - An object that specifies the body of the request. Best effort to adhere to the <a href="https://developer.mozilla.org/en-US/docs/Web/API/fetch#body">Fetch API body</a> parameter.</li>
<li><code>cache</code> - Will basically act as <code>force-cache</code> for the request. Best effort to adhere to the <a href="https://developer.mozilla.org/en-US/docs/Web/API/fetch#cache">Fetch API cache</a> parameter.</li>
</ol>
<p>Non-Fetch API options that will be supported:</p>
<ol>
<li><code>onProgress</code> - Similar to Helia <code>onProgress</code> options, this will be a function that will be called with a progress event. Supported progress events are:
<ul>
<li><code>helia:verified-fetch:error</code> - An error occurred during the request.</li>
<li><code>helia:verified-fetch:request:start</code> - The request has been sent</li>
<li><code>helia:verified-fetch:request:complete</code> - The request has been sent</li>
<li><code>helia:verified-fetch:request:error</code> - An error occurred during the request.</li>
<li><code>helia:verified-fetch:request:abort</code> - The request was aborted prior to completion.</li>
<li><code>helia:verified-fetch:response:start</code> - The initial HTTP Response headers have been set, and response stream is started.</li>
<li><code>helia:verified-fetch:response:complete</code> - The response stream has completed.</li>
<li><code>helia:verified-fetch:response:error</code> - An error occurred while building the response.</li>
</ul>
</li>
</ol>
<p>Some in-flight specs (IPIPs) that will affect the options object this library supports in the future can be seen at <a href="https://specs.ipfs.tech/ipips">https://specs.ipfs.tech/ipips</a>, a subset are:</p>
<ol>
<li><a href="https://specs.ipfs.tech/ipips/ipip-0412/">IPIP-0412: Signaling Block Order in CARs on HTTP Gateways</a></li>
<li><a href="https://specs.ipfs.tech/ipips/ipip-0402/">IPIP-0402: Partial CAR Support on Trustless Gateways</a></li>
<li><a href="https://specs.ipfs.tech/ipips/ipip-0386/">IPIP-0386: Subdomain Gateway Interop with _redirects</a></li>
<li><a href="https://specs.ipfs.tech/ipips/ipip-0328/">IPIP-0328: JSON and CBOR Response Formats on HTTP Gateways</a></li>
<li><a href="https://specs.ipfs.tech/ipips/ipip-0288/">IPIP-0288: TAR Response Format on HTTP Gateways</a></li>
</ol>
<h3 id="response-types" class="tsd-anchor-link">Response types<a href="#response-types" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>This library's purpose is to return reasonably representable content from IPFS. In other words, fetching content is intended for leaf-node content -- such as images/videos/audio &amp; other assets, or other IPLD content (with link) -- that can be represented by <a href="https://developer.mozilla.org/en-US/docs/Web/API/Response#instance_methods">https://developer.mozilla.org/en-US/docs/Web/API/Response#instance_methods</a>. The content type you receive back will depend upon the CID you request as well as the <code>Accept</code> header value you provide.</p>
<p>All content we retrieve from the IPFS network is obtained via an AsyncIterable, and will be set as the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Response/Response#body">body of the HTTP Response</a> via a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Streams_API/Using_readable_streams#consuming_a_fetch_as_a_stream"><code>ReadableStream</code></a> or other efficient method that avoids loading the entire response into memory or getting the entire response from the network before returning a response to the user.</p>
<p>If your content doesn't have a mime-type or an <a href="https://specs.ipfs.tech">IPFS spec</a>, this library will not support it, but you can use the <a href="https://github.com/ipfs/helia"><code>helia</code></a> library directly for those use cases. See <a href="#unsupported-response-types">Unsupported response types</a> for more information.</p>
<h4 id="handling-response-types" class="tsd-anchor-link">Handling response types<a href="#handling-response-types" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>For handling responses we want to follow conventions/abstractions from Fetch API where possible:</p>
<ul>
<li>For JSON, assuming you abstract any differences between dag-json/dag-cbor/json/and json-file-on-unixfs, you would call <code>.json()</code> to get a JSON object.</li>
<li>For images (or other web-relevant asset) you want to add to the DOM, use <code>.blob()</code> or <code>.arrayBuffer()</code> to get the raw bytes.</li>
<li>For plain text in utf-8, you would call <code>.text()</code></li>
<li>For streaming response data, use something like <code>response.body.getReader()</code> to get a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Streams_API/Using_readable_streams#consuming_a_fetch_as_a_stream"><code>ReadableStream</code></a>.</li>
</ul>
<h4 id="unsupported-response-types" class="tsd-anchor-link">Unsupported response types<a href="#unsupported-response-types" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li>Returning IPLD nodes or DAGs as JS objects is not supported, as there is no currently well-defined structure for representing this data in an <a href="https://developer.mozilla.org/en-US/docs/Web/API/Response">HTTP Response</a>. Instead, users should request <code>aplication/vnd.ipld.car</code> or use the <a href="https://github.com/ipfs/helia"><code>helia</code></a> library directly for this use case.</li>
<li>Others? Open an issue or PR!</li>
</ul>
<h3 id="response-headers" class="tsd-anchor-link">Response headers<a href="#response-headers" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>This library will set the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Response">HTTP Response</a> headers to the appropriate values for the content type according to the appropriate <a href="https://specs.ipfs.tech/">IPFS Specifications</a>.</p>
<p>Some known header specifications:</p>
<ul>
<li><a href="https://specs.ipfs.tech/http-gateways/path-gateway/#response-headers">https://specs.ipfs.tech/http-gateways/path-gateway/#response-headers</a></li>
<li><a href="https://specs.ipfs.tech/http-gateways/trustless-gateway/#response-headers">https://specs.ipfs.tech/http-gateways/trustless-gateway/#response-headers</a></li>
<li><a href="https://specs.ipfs.tech/http-gateways/subdomain-gateway/#response-headers">https://specs.ipfs.tech/http-gateways/subdomain-gateway/#response-headers</a></li>
</ul>
<h4 id="server-timing-headers" class="tsd-anchor-link">Server Timing headers<a href="#server-timing-headers" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>By default, we do not include <a href="https://developer.mozilla.org/en-US/docs/Web/API/Performance_API/Server_timing">Server Timing</a> headers in responses. If you want to include them, you can pass an
<code>withServerTiming</code> option to the <code>createVerifiedFetch</code> function to include them in all future responses. You can
also pass the <code>withServerTiming</code> option to each fetch call to include them only for that specific response.</p>
<p>See PR where this was added, <a href="https://github.com/ipfs/helia-verified-fetch/pull/164">https://github.com/ipfs/helia-verified-fetch/pull/164</a>, for more information.</p>
<h3 id="possible-scenarios-that-could-cause-confusion" class="tsd-anchor-link">Possible Scenarios that could cause confusion<a href="#possible-scenarios-that-could-cause-confusion" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><h4 id="attempting-to-fetch-the-cid-for-content-that-does-not-make-sense" class="tsd-anchor-link">Attempting to fetch the CID for content that does not make sense<a href="#attempting-to-fetch-the-cid-for-content-that-does-not-make-sense" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>If you request <code>bafybeiaysi4s6lnjev27ln5icwm6tueaw2vdykrtjkwiphwekaywqhcjze</code>, which points to the root of the <a href="http://en.wikipedia.org">en.wikipedia.org</a> mirror, a response object does not make sense.</p>
<h3 id="errors" class="tsd-anchor-link">Errors<a href="#errors" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Known Errors that can be thrown:</p>
<ol>
<li><code>TypeError</code> - If the resource argument is not a string, CID, or CID string.</li>
<li><code>TypeError</code> - If the options argument is passed and not an object.</li>
<li><code>TypeError</code> - If the options argument is passed and is malformed.</li>
<li><code>AbortError</code> - If the content request is aborted due to user aborting provided AbortSignal. Note that this is a <code>AbortError</code> from <code>@libp2p/interface</code> and not the standard <code>AbortError</code> from the Fetch API.</li>
</ol>
<h2 id="extensibility" class="tsd-anchor-link">Extensibility<a href="#extensibility" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Verifiedfetch can now be extended to alter how it handles requests by using plugins.
Plugins are classes that extend the <code>BasePlugin</code> class and implement the <code>VerifiedFetchPlugin</code>
interface. They are instantiated with <code>PluginOptions</code> when the <code>VerifiedFetch</code> class is created.</p>
<p>Each plugin must implement two methods:</p>
<ul>
<li>
<p><strong><code>canHandle(context: PluginContext): boolean</code></strong>
Inspects the current <code>PluginContext</code> (which includes the CID, path, query, accept header, etc.)
and returns <code>true</code> if the plugin can operate on the current state of the request.</p>
</li>
<li>
<p><strong><code>handle(context: PluginContext): Promise&lt;Response | null&gt;</code></strong>
Performs the plugins work. It may:</p>
<ul>
<li><strong>Return a final <code>Response</code></strong>: This stops the pipeline immediately.</li>
<li><strong>Return <code>null</code></strong>: This indicates that the plugin has only partially processed the request
(for example, by performing path walking or decoding) and the pipeline should continue.</li>
<li><strong>Throw a <code>PluginError</code></strong>: This logs a non-fatal error and continues the pipeline.</li>
<li><strong>Throw a <code>PluginFatalError</code></strong>: This logs a fatal error and stops the pipeline immediately.</li>
</ul>
</li>
</ul>
<p>Plugins are executed in a chain (a <strong>plugin pipeline</strong>):</p>
<ol>
<li>
<p><strong>Initialization:</strong></p>
<ul>
<li>The <code>VerifiedFetch</code> class is instantiated with a list of plugins.</li>
<li>When a request is made via the <code>fetch</code> method, the resource and options are parsed to
create a mutable <code>PluginContext</code> object.</li>
</ul>
</li>
<li>
<p><strong>Pipeline Execution:</strong></p>
<ul>
<li>The pipeline repeatedly checks, up to a maximum number of passes (default = 3), which plugins
are currently able to handle the request by calling each plugins <code>canHandle()</code> method.</li>
<li>Plugins that have not yet been called in the current run and return <code>true</code> for <code>canHandle()</code>
are invoked in sequence.
<ul>
<li>If a plugin returns a final <code>Response</code> or throws a <code>PluginFatalError</code>, the pipeline immediately
stops and that response is returned.</li>
<li>If a plugin returns <code>null</code>, it may have updated the context (for example, by
performing path walking), other plugins that said they <code>canHandle</code> will run.</li>
</ul>
</li>
<li>If no plugin modifies the context (i.e. no change to <code>context.modified</code>) and no final response is
produced after iterating through all plugins, the pipeline exits and a default Not Supported
response is returned.</li>
</ul>
<p><strong>Diagram of the Plugin Pipeline:</strong></p>
</li>
</ol>
<div class="mermaid-block"><div class="mermaid dark">%%{init:{"theme":"dark"}}%%
flowchart TD
    A[Resource &amp; Options] --&gt; B[Parse into PluginContext]
    B --&gt; C[Plugin Pipeline]
    subgraph IP[Iterative Passes max 3 passes]
      C1[Check canHandle for each plugin]
      C2[Call handle on ready plugins]
      C3[Update PluginContext if partial work is done]
      C1 --&gt; C2
      C2 --&gt; C3
    end
    C --&gt; IP
    IP --&gt; D[Final Response]</div><div class="mermaid light">%%{init:{"theme":"default"}}%%
flowchart TD
    A[Resource &amp; Options] --&gt; B[Parse into PluginContext]
    B --&gt; C[Plugin Pipeline]
    subgraph IP[Iterative Passes max 3 passes]
      C1[Check canHandle for each plugin]
      C2[Call handle on ready plugins]
      C3[Update PluginContext if partial work is done]
      C1 --&gt; C2
      C2 --&gt; C3
    end
    C --&gt; IP
    IP --&gt; D[Final Response]</div><pre><code class="language-mermaid">flowchart TD
    A[Resource &amp; Options] --&gt; B[Parse into PluginContext]
    B --&gt; C[Plugin Pipeline]
    subgraph IP[Iterative Passes max 3 passes]
      C1[Check canHandle for each plugin]
      C2[Call handle on ready plugins]
      C3[Update PluginContext if partial work is done]
      C1 --&gt; C2
      C2 --&gt; C3
    end
    C --&gt; IP
    IP --&gt; D[Final Response]</code></pre></div>
<ol start="3">
<li><strong>Finalization:</strong>
<ul>
<li>After the pipeline completes, the resulting response &amp; context is processed (e.g. headers such as ETag,
CacheControl, and ContentDisposition are set) and returned.</li>
</ul>
</li>
</ol>
<p>Please see the original discussion on extensibility in <a href="https://github.com/ipfs/helia-verified-fetch/issues/167">Issue #167</a>.</p>
<hr>
<h3 id="extending-verifiedfetch-with-custom-plugins" class="tsd-anchor-link">Extending VerifiedFetch with Custom Plugins<a href="#extending-verifiedfetch-with-custom-plugins" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>To add your own plugin:</p>
<ol>
<li>
<p><strong>Extend the BasePlugin:</strong></p>
<p>Create a new class that extends <code>BasePlugin</code> and implements:</p>
<ul>
<li><code>canHandle(context: PluginContext): boolean</code></li>
<li><code>handle(context: PluginContext): Promise&lt;Response | null&gt;</code></li>
</ul>
</li>
</ol>
<h2 id="example---custom-plugin" class="tsd-anchor-link">Example - custom plugin<a href="#example---custom-plugin" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="typescript"><span class="hl-1">   </span><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">BasePlugin</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@helia/verified-fetch&#39;</span><br/><span class="hl-1">   </span><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-0">type</span><span class="hl-1"> { </span><span class="hl-2">PluginContext</span><span class="hl-1">, </span><span class="hl-2">VerifiedFetchPluginFactory</span><span class="hl-1">, </span><span class="hl-2">PluginOptions</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@helia/verified-fetch&#39;</span><br/><br/><span class="hl-1">   </span><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-4">class</span><span class="hl-1"> </span><span class="hl-8">MyCustomPlugin</span><span class="hl-1"> </span><span class="hl-4">extends</span><span class="hl-1"> </span><span class="hl-8">BasePlugin</span><span class="hl-1"> {</span><br/><span class="hl-1">     </span><span class="hl-2">id</span><span class="hl-1"> = </span><span class="hl-3">&#39;my-custom-plugin&#39;</span><span class="hl-1"> </span><span class="hl-7">// Required: must be unique unless you want to override one of the default plugins.</span><br/><br/><span class="hl-1">     </span><span class="hl-7">// Optionally, list any codec codes your plugin supports:</span><br/><span class="hl-1">     </span><span class="hl-2">codes</span><span class="hl-1"> = [] </span><span class="hl-7">//</span><br/><br/><span class="hl-1">     </span><span class="hl-6">canHandle</span><span class="hl-1">(</span><span class="hl-2">context</span><span class="hl-1">: </span><span class="hl-8">PluginContext</span><span class="hl-1">): </span><span class="hl-8">boolean</span><span class="hl-1"> {</span><br/><span class="hl-1">       </span><span class="hl-7">// Only handle requests if the Accept header matches your custom type</span><br/><span class="hl-1">       </span><span class="hl-7">// Or check context for pathDetails, custom values, etc...</span><br/><span class="hl-1">       </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-2">context</span><span class="hl-1">.</span><span class="hl-2">accept</span><span class="hl-1"> === </span><span class="hl-3">&#39;application/vnd.my-custom-type&#39;</span><br/><span class="hl-1">     }</span><br/><br/><span class="hl-1">     </span><span class="hl-4">async</span><span class="hl-1"> </span><span class="hl-6">handle</span><span class="hl-1">(</span><span class="hl-2">context</span><span class="hl-1">: </span><span class="hl-8">PluginContext</span><span class="hl-1">): </span><span class="hl-8">Promise</span><span class="hl-1">&lt;</span><span class="hl-8">Response</span><span class="hl-1"> | </span><span class="hl-8">null</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">       </span><span class="hl-7">// Perform any partial processing here, e.g., modify the context:</span><br/><span class="hl-1">       </span><span class="hl-2">context</span><span class="hl-1">.</span><span class="hl-2">customProcessed</span><span class="hl-1"> = </span><span class="hl-4">true</span><span class="hl-1">;</span><br/><br/><span class="hl-1">       </span><span class="hl-7">// If you are ready to finalize the response:</span><br/><span class="hl-1">       </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">Response</span><span class="hl-1">(</span><span class="hl-3">&#39;Hello, world!&#39;</span><span class="hl-1">, {</span><br/><span class="hl-1">         </span><span class="hl-2">status:</span><span class="hl-1"> </span><span class="hl-9">200</span><span class="hl-1">,</span><br/><span class="hl-1">         </span><span class="hl-2">headers:</span><span class="hl-1"> {</span><br/><span class="hl-1">           </span><span class="hl-3">&#39;Content-Type&#39;</span><span class="hl-2">:</span><span class="hl-1"> </span><span class="hl-3">&#39;text/plain&#39;</span><br/><span class="hl-1">         }</span><br/><span class="hl-1">       });</span><br/><br/><span class="hl-1">       </span><span class="hl-7">// Or, if further processing is needed by another plugin, simply return null.</span><br/><span class="hl-1">     }</span><br/><span class="hl-1">   }</span><br/><span class="hl-1">   </span><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">myCustomPluginFactory</span><span class="hl-1">: </span><span class="hl-8">VerifiedFetchPluginFactory</span><span class="hl-1"> = (</span><span class="hl-2">opts</span><span class="hl-1">: </span><span class="hl-8">PluginOptions</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">MyCustomPlugin</span><span class="hl-1">(</span><span class="hl-2">opts</span><span class="hl-1">)</span>
</code><button type="button">Copy</button></pre>

<ol start="2">
<li>
<p><strong>Integrate Your Plugin:</strong></p>
<p>Add your custom plugin to VerifiedFetchs plugin list when instantiating VerifiedFetch:</p>
</li>
</ol>
<h2 id="example---integrate-custom-plugin" class="tsd-anchor-link">Example - Integrate custom plugin<a href="#example---integrate-custom-plugin" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="typescript"><span class="hl-1">   </span><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">createVerifiedFetch</span><span class="hl-1">, </span><span class="hl-0">type</span><span class="hl-1"> </span><span class="hl-2">VerifiedFetchPluginFactory</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@helia/verified-fetch&#39;</span><br/><span class="hl-1">   </span><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">createHelia</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;helia&#39;</span><br/><br/><span class="hl-1">   </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">helia</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">createHelia</span><span class="hl-1">()</span><br/><span class="hl-1">   </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">plugins</span><span class="hl-1">: </span><span class="hl-8">VerifiedFetchPluginFactory</span><span class="hl-1">[] = [</span><br/><span class="hl-1">     </span><span class="hl-7">// myCustomPluginFactory</span><br/><span class="hl-1">   ]</span><br/><br/><span class="hl-1">   </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">fetch</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-6">createVerifiedFetch</span><span class="hl-1">(</span><span class="hl-2">helia</span><span class="hl-1">, { </span><span class="hl-2">plugins</span><span class="hl-1"> })</span>
</code><button type="button">Copy</button></pre>

<hr>
<h3 id="error-handling-in-the-plugin-pipeline" class="tsd-anchor-link">Error Handling in the Plugin Pipeline<a href="#error-handling-in-the-plugin-pipeline" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>VerifiedFetch distinguishes between two types of errors thrown by plugins:</p>
<ul>
<li>
<p><strong>PluginError (NonFatal):</strong></p>
<ul>
<li>Use this when your plugin encounters an issue that should be logged but does not prevent the pipeline
from continuing.</li>
<li>When a plugin throws a <code>PluginError</code>, the error is logged and the pipeline continues with the next plugin.</li>
</ul>
</li>
<li>
<p><strong>PluginFatalError (Fatal):</strong></p>
<ul>
<li>Use this when a critical error occurs that should immediately abort the request.</li>
<li>When a plugin throws a <code>PluginFatalError</code>, the pipeline immediately terminates and the provided error
response is returned.</li>
</ul>
</li>
</ul>
<h2 id="example---plugin-error-handling" class="tsd-anchor-link">Example - Plugin error Handling<a href="#example---plugin-error-handling" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="typescript"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">PluginError</span><span class="hl-1">, </span><span class="hl-2">PluginFatalError</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;@helia/verified-fetch&#39;</span><br/><br/><span class="hl-7">// async handle(context: PluginContext): Promise&lt;Response | null&gt; {</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-5">recoverable</span><span class="hl-1"> = </span><span class="hl-2">Math</span><span class="hl-1">.</span><span class="hl-6">random</span><span class="hl-1">() &gt; </span><span class="hl-9">0.5</span><span class="hl-1"> </span><span class="hl-7">// Use more sophisticated logic here ;)</span><br/><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">recoverable</span><span class="hl-1"> === </span><span class="hl-4">true</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">PluginError</span><span class="hl-1">(</span><span class="hl-3">&#39;MY_CUSTOM_WARNING&#39;</span><span class="hl-1">, </span><span class="hl-3">&#39;A nonfatal issue occurred&#39;</span><span class="hl-1">, {</span><br/><span class="hl-1">    </span><span class="hl-2">details:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">someKey:</span><span class="hl-1"> </span><span class="hl-3">&#39;Additional details here&#39;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">recoverable</span><span class="hl-1"> === </span><span class="hl-4">false</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">PluginFatalError</span><span class="hl-1">(</span><span class="hl-3">&#39;MY_CUSTOM_FATAL&#39;</span><span class="hl-1">, </span><span class="hl-3">&#39;A critical error occurred&#39;</span><span class="hl-1">, {</span><br/><span class="hl-1">    </span><span class="hl-2">response:</span><span class="hl-1"> </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-6">Response</span><span class="hl-1">(</span><span class="hl-3">&#39;Something happened&#39;</span><span class="hl-1">, { </span><span class="hl-2">status:</span><span class="hl-1"> </span><span class="hl-9">500</span><span class="hl-1"> })  </span><span class="hl-7">// Required: supply your own error response</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-1">  </span><span class="hl-7">// Otherwise, continue processing...</span><br/><span class="hl-7">// }</span>
</code><button type="button">Copy</button></pre>

<h3 id="how-the-plugin-pipeline-works" class="tsd-anchor-link">How the Plugin Pipeline Works<a href="#how-the-plugin-pipeline-works" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li>
<p><strong>Shared Context:</strong>
A mutable <code>PluginContext</code> is created for each request. It includes the parsed CID, path, query parameters,
accept header, and any other metadata. Plugins can update this context as they perform partial work (for example,
by doing path walking or decoding).</p>
</li>
<li>
<p><strong>Iterative Processing:</strong>
The pipeline repeatedly checks which plugins can currently handle the request by calling <code>canHandle(context)</code>.</p>
<ul>
<li>Plugins that perform partial processing update the context and return <code>null</code>, allowing subsequent passes by other plugins.</li>
<li>Once a plugin is ready to finalize the response, it returns a final <code>Response</code> and the pipeline terminates.</li>
</ul>
</li>
<li>
<p><strong>No Strict Ordering:</strong>
Plugins are invoked based solely on whether they can handle the current state of the context.
This means you do not have to specify a rigid order, each plugin simply checks the context and acts if appropriate.</p>
</li>
<li>
<p><strong>Error Handling:</strong></p>
<ul>
<li>A thrown <code>PluginError</code> is considered nonfatal and is logged, allowing the pipeline to continue.</li>
<li>A thrown <code>PluginFatalError</code> immediately stops the pipeline and returns the error response.</li>
</ul>
</li>
</ul>
<p>For a detailed explanation of the pipeline, please refer to the discussion in <a href="https://github.com/ipfs/helia-verified-fetch/issues/167">Issue #167</a>.</p>
<h1 id="install" class="tsd-anchor-link">Install<a href="#install" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><pre><code class="console"><span class="hl-1">$ npm i @helia/verified-fetch</span>
</code><button type="button">Copy</button></pre>

<h2 id="browser--tag" class="tsd-anchor-link">Browser <code>&lt;script&gt;</code> tag<a href="#browser--tag" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Loading this module through a script tag will make its exports available as <code>HeliaVerifiedFetch</code> in the global namespace.</p>
<pre><code class="html"><span class="hl-10">&lt;</span><span class="hl-11">script</span><span class="hl-12"> </span><span class="hl-13">src</span><span class="hl-12">=</span><span class="hl-14">&quot;https://unpkg.com/@helia/verified-fetch/dist/index.min.js&quot;</span><span class="hl-10">&gt;&lt;/</span><span class="hl-11">script</span><span class="hl-10">&gt;</span>
</code><button type="button">Copy</button></pre>

<h1 id="api-docs" class="tsd-anchor-link">API Docs<a href="#api-docs" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><ul>
<li><a href="https://ipfs.github.io/helia-verified-fetch/modules/_helia_verified_fetch.html">https://ipfs.github.io/helia-verified-fetch/modules/_helia_verified_fetch.html</a></li>
</ul>
<h1 id="license" class="tsd-anchor-link">License<a href="#license" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p>Licensed under either of</p>
<ul>
<li>Apache 2.0, (<a href="https://github.com/ipfs/helia-verified-fetch/blob/main/packages/verified-fetch/LICENSE-APACHE">LICENSE-APACHE</a> / <a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a>)</li>
<li>MIT (<a href="https://github.com/ipfs/helia-verified-fetch/blob/main/packages/verified-fetch/LICENSE-MIT">LICENSE-MIT</a> / <a href="http://opensource.org/licenses/MIT">http://opensource.org/licenses/MIT</a>)</li>
</ul>
<h1 id="contribute" class="tsd-anchor-link">Contribute<a href="#contribute" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p>Contributions welcome! Please check out <a href="https://github.com/ipfs/helia-verified-fetch/issues">the issues</a>.</p>
<p>Also see our <a href="https://github.com/ipfs/community/blob/master/CONTRIBUTING_JS.md">contributing document</a> for more information on how we work, and about contributing in general.</p>
<p>Please be aware that all interactions related to this repo are subject to the IPFS <a href="https://github.com/ipfs/community/blob/master/code-of-conduct.md">Code of Conduct</a>.</p>
<p>Unless you explicitly state otherwise, any contribution intentionally submitted for inclusion in the work by you, as defined in the Apache-2.0 license, shall be dual licensed as above, without any additional terms or conditions.</p>
<p><a href="https://github.com/ipfs/community/blob/master/CONTRIBUTING.md"><img src="https://cdn.rawgit.com/jbenet/contribute-ipfs-gif/master/img/contribute.gif" alt=""></a></p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#heliaverified-fetch"><span>@helia/verified-<wbr/>fetch</span></a><a href="#about"><span>About</span></a><ul><li><a href="#example---getting-started"><span>Example -<wbr/> <wbr/>Getting started</span></a></li><li><a href="#example---using-a-cid-instance-to-fetch-json"><span>Example -<wbr/> <wbr/>Using a <wbr/>CID instance to fetch <wbr/>JSON</span></a></li><li><a href="#example---using-ipfs-protocol-to-fetch-an-image"><span>Example -<wbr/> <wbr/>Using <wbr/>IPFS protocol to fetch an image</span></a></li><li><a href="#example---using-ipns-protocol-to-stream-a-big-file"><span>Example -<wbr/> <wbr/>Using <wbr/>IPNS protocol to stream a big file</span></a></li><li><a href="#configuration"><span>Configuration</span></a></li><li><ul><li><a href="#custom-http-gateways-and-routers"><span>Custom <wbr/>HTTP gateways and routers</span></a></li></ul></li><li><a href="#example---configuring-gateways-and-routers"><span>Example -<wbr/> <wbr/>Configuring gateways and routers</span></a></li><li><ul><li><a href="#usage-with-customized-helia"><span>Usage with customized <wbr/>Helia</span></a></li><li><a href="#custom-content-type-parsing"><span>Custom content-<wbr/>type parsing</span></a></li></ul></li><li><a href="#example---customizing-content-type-parsing"><span>Example -<wbr/> <wbr/>Customizing content-<wbr/>type parsing</span></a></li><li><ul><li><a href="#custom-dns-resolvers"><span>Custom <wbr/>DNS resolvers</span></a></li></ul></li><li><a href="#example---customizing-dns-resolvers"><span>Example -<wbr/> <wbr/>Customizing <wbr/>DNS resolvers</span></a></li><li><a href="#example---customizing-dns-per-tld-resolvers"><span>Example -<wbr/> <wbr/>Customizing <wbr/>DNS per-<wbr/>TLD resolvers</span></a></li><li><ul><li><a href="#custom-hashers"><span>Custom <wbr/>Hashers</span></a></li></ul></li><li><a href="#example---passing-a-custom-hashing-function"><span>Example -<wbr/> <wbr/>Passing a custom hashing function</span></a></li><li><ul><li><a href="#ipld-codec-handling"><span>IPLD codec handling</span></a></li><li><ul><li><a href="#dag-pb"><span>DAG-<wbr/>PB</span></a></li><li><ul><li><a href="#using-the-dag-pb-codec-as-a-blob"><span>Using the <wbr/>DAG-<wbr/>PB codec as a <wbr/>Blob</span></a></li><li><a href="#using-the-dag-pb-codec-as-an-arraybuffer"><span>Using the <wbr/>DAG-<wbr/>PB codec as an <wbr/>Array<wbr/>Buffer</span></a></li><li><a href="#using-the-dag-pb-codec-as-a-stream"><span>Using the <wbr/>DAG-<wbr/>PB codec as a stream</span></a></li><li><a href="#content-type"><span>Content-<wbr/>Type</span></a></li></ul></li><li><a href="#json"><span>JSON</span></a></li><li><ul><li><a href="#using-the-json-codec"><span>Using the <wbr/>JSON codec</span></a></li><li><a href="#content-type-1"><span>Content-<wbr/>Type</span></a></li></ul></li></ul></li><li><a href="#dag-json"><span>DAG-<wbr/>JSON</span></a></li><li><ul><li><ul><li><a href="#using-the-dag-json-codec"><span>Using the <wbr/>DAG-<wbr/>JSON codec</span></a></li><li><a href="#content-type-2"><span>Content-<wbr/>Type</span></a></li></ul></li><li><a href="#dag-cbor"><span>DAG-<wbr/>CBOR</span></a></li><li><ul><li><a href="#content-type-3"><span>Content-<wbr/>Type</span></a></li><li><a href="#detecting-json-safe-dag-cbor"><span>Detecting <wbr/>JSON-<wbr/>safe <wbr/>DAG-<wbr/>CBOR</span></a></li></ul></li></ul></li></ul></li><li><a href="#the-accept-header"><span>The <wbr/>Accept header</span></a></li><li><a href="#redirects"><span>Redirects</span></a></li><li><a href="#example---redirect-follow"><span>Example -<wbr/> <wbr/>Redirect: follow</span></a></li><li><a href="#example---redirect-error"><span>Example -<wbr/> <wbr/>Redirect: error</span></a></li><li><a href="#example---redirect-manual"><span>Example -<wbr/> <wbr/>Redirect: manual</span></a></li><li><a href="#comparison-to-fetch"><span>Comparison to fetch</span></a></li><li><ul><li><a href="#resource-argument"><span>Resource argument</span></a></li><li><a href="#options-argument"><span>Options argument</span></a></li><li><a href="#response-types"><span>Response types</span></a></li><li><ul><li><a href="#handling-response-types"><span>Handling response types</span></a></li><li><a href="#unsupported-response-types"><span>Unsupported response types</span></a></li></ul></li><li><a href="#response-headers"><span>Response headers</span></a></li><li><ul><li><a href="#server-timing-headers"><span>Server <wbr/>Timing headers</span></a></li></ul></li><li><a href="#possible-scenarios-that-could-cause-confusion"><span>Possible <wbr/>Scenarios that could cause confusion</span></a></li><li><ul><li><a href="#attempting-to-fetch-the-cid-for-content-that-does-not-make-sense"><span>Attempting to fetch the <wbr/>CID for content that does not make sense</span></a></li></ul></li><li><a href="#errors"><span>Errors</span></a></li></ul></li><li><a href="#extensibility"><span>Extensibility</span></a></li><li><ul><li><a href="#extending-verifiedfetch-with-custom-plugins"><span>Extending <wbr/>Verified<wbr/>Fetch with <wbr/>Custom <wbr/>Plugins</span></a></li></ul></li><li><a href="#example---custom-plugin"><span>Example -<wbr/> custom plugin</span></a></li><li><a href="#example---integrate-custom-plugin"><span>Example -<wbr/> <wbr/>Integrate custom plugin</span></a></li><li><ul><li><a href="#error-handling-in-the-plugin-pipeline"><span>Error <wbr/>Handling in the <wbr/>Plugin <wbr/>Pipeline</span></a></li></ul></li><li><a href="#example---plugin-error-handling"><span>Example -<wbr/> <wbr/>Plugin error <wbr/>Handling</span></a></li><li><ul><li><a href="#how-the-plugin-pipeline-works"><span>How the <wbr/>Plugin <wbr/>Pipeline <wbr/>Works</span></a></li></ul></li></ul><a href="#install"><span>Install</span></a><ul><li><a href="#browser--tag"><span>Browser &lt;script&gt; tag</span></a></li></ul><a href="#api-docs"><span>API <wbr/>Docs</span></a><a href="#license"><span>License</span></a><a href="#contribute"><span>Contribute</span></a></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html">@helia/verified-fetch</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div>
<script type="module">
import mermaid from "https://unpkg.com/mermaid@latest/dist/mermaid.esm.min.mjs";

document.documentElement.classList.add("mermaid-enabled");

mermaid.initialize({startOnLoad:true});

requestAnimationFrame(function check() {
  let some = false;
  document.querySelectorAll("div.mermaid:not([data-inserted])").forEach(div => {
    some = true;
    if (div.querySelector("svg")) {
      div.dataset.inserted = true;
    }
  });

  if (some) {
    requestAnimationFrame(check);
  }
});
</script>
</body></html>
